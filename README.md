# ishop - part 2
# Часть 2. Написание пользовательской части CMS интернет-магазина

## ДЗ 2-4 - рассчитать размер скидки программно (при наличии старой цены)
### app\views\Main\index.php (line 78)

## ДЗ 2-6 - делать не запрос к БД, а выбирать валюту из контейнера (реестра)
### app\controllers\CurrencyController (line 15)

## ДЗ 2-7 - сделать функцию округления при пересчете цены
### app\views\Main\index.php (line 71, 74)

## ДЗ 2-15 - ссылка для просмотра всех просмотренных товаров
### app\controllers\ProductController (line 39)

## ДЗ 2-17 - модификации товара (цвет + размер, обновлять старую цену вместе с базовой (старые цены для модификаций излишне))
### app\controllers\ProductController (line 54)
### app\views\Product\view.php (line 66, 75)
* цена может отличать и от цвета и от размера
* можно сделать что-то вроде зависимых списков - при выборе 1 подгружить что-то другое (и наоборот)
* также учитывать, что 1 цвет может быть все цвета, а другой цвет - не все (часть списка)

## ДЗ 2-22 - в корзине реализовать увеличение и уменьшение количества по каждой позиции
### app\controllers\CartController
### app\models\Cart
### public\js\main.js

# Исключения - throw new \Exception('Страница не найдена', 404);
## https://www.php.net/manual/ru/language.exceptions.php

# htmlspecialchars() является подмножеством htmlentities().

## В то время как htmlentities преобразует «все применимые символы в HTML-объекты», htmlspecialchars() преобразует только символы ниже:
* ‘&’ (Амперсанд) становится ‘&amp;’
* ‘ ” ‘ (Двойная кавычка) становится ‘ &quot; ’, когда ENT_NOQUOTES не установлен.
* « ‘ » (Одинарная кавычка) становится ‘ ' ’ (или & apos) только в том случае, если установлен ENT_QUOTES.
* ‘>’ (Больше чем) становится ‘& gt;’

## Обе функции используются для «вывода», чтобы обезопасить веб-страницу от атак с использованием межсайтовых сценариев. Однако в книге Essential PHP Security говорится…
* «Htmlentities() - лучшая экранирующая функция для экранирования данных, отправляемых клиенту».
* Используйте флаг ENT_QUOTES и кодировку UTF-8, как ниже в примере
* htmlentities($userdata, ENT_QUOTES, 'UTF-8');
* Флаг ENT_QUOTES указывает ему преобразовывать как двойные, так и одинарные кавычки.
* И на заметку, параметры двух функций идентичны.

## htmlspecialchars:

1. Если нет необходимости кодировать все символы, имеющие свои эквиваленты HTML.
* Если вы знаете, что кодировка страницы соответствует текстовым специальным символам, зачем использовать htmlentities? htmlspecialchars является очень простым, и выдает меньше кода для отправки клиенту. Например:

```php
echo htmlentities('<Il était une fois un être>.');
// Output: &lt;Il &eacute;tait une fois un &ecirc;tre&gt;.
//                ^^^^^^^^                 ^^^^^^^
```

```php
echo htmlspecialchars('<Il était une fois un être>.');
// Output: &lt;Il était une fois un être&gt;.
//                ^                 ^
```

* Второй вариант короче и не вызывает проблем, если установлена ​​кодировка ISO-8859-1.

2. Когда данные будут обрабатываться не только через браузер (чтобы избежать декодирования HTML-объектов),

3. Если вывод XML (см. ответ Artefacto).

## Потому что:

1. Иногда вы пишете XML-данные, и вы не можете использовать HTML-объекты в XML файле.
* Потому что htmlentities заменяет больше символов, чем htmlspecialchars. Это необязательно, делает PHP скрипт менее эффективным, а полученный HTML-код менее читабельным.
2. htmlentities необходимо, только если ваши страницы используют кодировки, такие как ASCII или LATIN-1 вместо UTF-8, и вы обрабатываете данные с кодировкой, отличной от страницы.

## Это кодируется htmlentities.

```php
implode( "\t", array_values( get_html_translation_table( HTML_ENTITIES ) ) ):

"& <>
¢ ¤ ¤ ¦ ¦ ¦ ¨ ª ± ± ± ´ ± ± ± µ º µ µ ½ ½ ½ À À À À À Ã Ã Å Å É É Ì Í Í Î Î Î Ð Î Î Ð Ð Ñ Ñ Ð Ð Ð Ð Ð Ð × Õ Ö ×
Ù Ú Û Û Û Û ß ß ß ß ã ç ç ç ç ç ë ë ì ì ì ï ï ò ò õ õ ü û ü œ Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š
Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š Š. Α Β Γ Δ Ε Ζ Η Θ Ι Λ Λ Μ Ν Ξ Ο Π Σ Σ Τ Υ Φ β Ω Ψ β α β γ γ γ
β η η θ ι ι λ μ μ ω ϑ ϒ ϖ ‌ ‍ - - - - „„ • • ‹‹ ‹‹ ‹‹ ‹‹ ℵ ℵ ℵ ℵ ⇒ ⇒ ⇒ ⇒ ⇒ ⇒ ⇒ ⇒ ⇒ ⇒ ∉ ∉ ∉ ∉ ∑ ∏ ∑ - ∗ √ ∞
∞ ∧ ∩ ∩ ∪ ∪ ∴ ≈ ≈ ≈ ≡ ≤ ≤ ≥ ≥ ⊄ ⊆ ⊇ ⊥ ⋅ ♦ ♦ ♦ ♦ ♦ ♦ ♦
```

## Это кодируется с помощью htmlspecialchars.
```php
implode( "\t", array_values( get_html_translation_table( HTML_SPECIALCHARS ) ) ):

"& <>
```